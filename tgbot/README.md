# Rutube telegram bot

Интеллектуальный помощник оператора службы поддержки Rutube в виде бота для [Telegram](https://telegram.org/).

Бот разработан с целью упростить взаимодействие пользователей и операторов службы техподдержки и автоматизировать обработку запросов.

## Основная функция бота:

Бот был создан чтобы пользователи могли быстро и удобно получать ответы на свои вопросы или продолжать общение с техподдержкой прямо в Telegram. По сути, он является связующим звеном между пользователем и системой поддержки Rutube, предоставляя простой и интуитивно понятный интерфейс для коммуникации.

## Интеграция с системой техподдержки:

Бот полностью интегрирован с нашей внутренней системой техподдержки. Для этого мы использовали два ключевых подхода:

1. **REST API** — для передачи данных между ботом и сервером техподдержки. Это позволяет боту отправлять запросы и получать структурированные ответы от системы.
2. **WebSocket** — для обеспечения квази-реалтайм работы. Это значит, что бот почти мгновенно получает и отправляет ответы и обновления с сервера, что делает взаимодействие с пользователем более быстрым и удобным.

### Основные возможности бота:
1. **Задать вопрос оператору службы поддержки и получить ответ**:
   - Пользователь может использовать бота, чтобы задать любой вопрос о RUTUBE. Запрос передаётся в систему техподдержки, где оператор или автоматизированная система обработки запросов (в зависимости от режима работы) отвечают на него. Ответы возвращаются пользователю прямо в чат с ботом.

2. **Начало или продолжение обращения со службой поддержки**:
   - Бот позволяет не только начать новый запрос, но и продолжить ранее начатый диалог. Мы реализовали поддержку [**deep linking**](https://core.telegram.org/bots/features#deep-linking), что даёт возможность пользователю вернуться к конкретному обращению через специальную ссылку — это облегчает процесс взаимодействия и сохраняет контекст общения.

3. **Смена режима работы (_для тестирования_)**:
   - Для тестирования мы добавили возможность переключаться между режимами работы. В тестовом режиме бот может получать ответы напрямую от LLM, что позволяет проверять его работу и корректность ответов в различных сценариях.

4. **Оценка качества оказанной помощи**:
   - После получения ответа пользователь может оценить оказанную помощь с помощью **inline кнопок** прямо в сообщении с ответом. Эти оценки интегрируются с нашей системой, что помогает нам отслеживать качество работы операторов и автоматизированных систем.

## Установка:

### [uv](https://docs.astral.sh/uv/)

```sh
uv venv

source .venv\bin\activate # Linux
.venv\Scripts\activate # Windows

uv sync
```

### pip

```sh
python -m venv .venv

source .venv\bin\activate # Linux
.venv\Scripts\activate # Windows

pip install -r requirements.txt
```

## Файл `.env`

Для запуска требуется создать файл с основными параметрами конфигурации.

> Токен бота можно получить у [Bot Father](https://t.me/BotFather).

Пример:

```ini
BOT_TOKEN = "1002225444:AAAee2_6oHd1Y9Msda_HLKlgscajrVT_EE" # Токен бота
LEVEL = "DEBUG" # Уровень логирования
WEB_URL = "https://copilot.rutube.ru" # URL фронта системы
API_URL = "https://copilot-api.rutube.ru" # URL API системы
API_PORT = "443" # DEPRECATED
WS_URL = "wss://copilot-api.rutube.ru" # URL WebSocket системы
WS_PORT = "80" # DEPRECATED
```


## Запуск:

### Локально

```sh
uv run main.py
```

> Можно запускать и без команду `uv run` при активированном окружении, либо установке через `pip`.

```sh
python main.py
```

### Docker

#### Запуск

1. Собрать Docker-образ:

```sh
docker build -t имя_образа .
```

2. Когда образ собран, запустить контейнер на основе образа:

```sh
docker run --name имя_контейнера имя_образа
```

#### Остановка и удаление

Если нужно остановить контейнер:

```sh
docker stop имя_контейнера
```

Если нужно удалить контейнер:

```sh
docker rm имя_контейнера
```

Если нужно удалить образ:

```sh
docker rmi имя_образа
```
